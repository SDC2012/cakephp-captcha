<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Cakephp-captcha by donovan-duplessis</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Cakephp-captcha</h1>
        <h2>Captcha implementation for CakePHP 2.2+</h2>
        <a href="https://github.com/donovan-duplessis/cakephp-captcha" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="captcha-support-for-cakephp-22" class="anchor" href="#captcha-support-for-cakephp-22"><span class="octicon octicon-link"></span></a>Captcha support for CakePHP 2.2+</h1>

<p>Generates an image with random alphanumeric characters which requires a human to validate.  This is to prevent automated spam and spam bots.</p>

<p>Features:</p>

<ul>
<li>Random alphanumeric text</li>
<li>Supports rotation of text</li>
<li>The image width and height dimensions can be set</li>
<li>The font size can be adjusted</li>
<li>Random monospace fonts are used during generation (anonymous, droidsans, ubuntu)</li>
<li>Multiple captchas allowed per form</li>
</ul><h2>
<a name="demonstration" class="anchor" href="#demonstration"><span class="octicon octicon-link"></span></a>Demonstration</h2>

<p><a href="http://captcha.baselocker.com">captcha.baselocker.com</a></p>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>PHP version: 5.2+</li>
<li>CakePHP version: 2.0+</li>
</ul><h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Clone or download the component:</p>

<pre><code>git clone git://github.com/donovan-duplessis/cakephp-captcha.git
</code></pre>

<p>Copy the component and behavior into your framework at:</p>

<pre><code>cd cakephp-captcha
cp Controller/Component/CaptchaComponent.php &lt;your-app&gt;/app/Controller/Component/
cp Model/Behavior/CaptchaBehavior.php &lt;your-app&gt;/app/Model/Behavior/
</code></pre>

<p>Copy the fonts into your framework at:</p>

<pre><code>cp -R Lib/Fonts &lt;your-app&gt;/app/Lib/
chmod 755 &lt;your-app&gt;/app/Lib/Fonts
</code></pre>

<p>GD library needs to be installed for PHP (for dynamic image creation):</p>

<p>Ubuntu</p>

<pre><code>sudo apt-get install php5-gd
</code></pre>

<p>Mac OSX (MacPorts)</p>

<pre><code>sudo port install php5-gd
</code></pre>

<h2>
<a name="errors" class="anchor" href="#errors"><span class="octicon octicon-link"></span></a>Errors</h2>

<p>e.g. "Call to undefined function imagecreatetruecolor ()"</p>

<p>Install php5-gd library as described above</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Include Captcha behavior in model:<br></p>

<pre><code>public $actsAs = array('Captcha');
</code></pre>

<p>Include Captcha component in controller:</p>

<pre><code>public $components = array('Captcha');
</code></pre>

<p>To output the captcha image from controller:</p>

<pre><code>$this-&gt;Captcha-&gt;generate();
</code></pre>

<h2>
<a name="reload-image" class="anchor" href="#reload-image"><span class="octicon octicon-link"></span></a>Reload image</h2>

<p>Refer to sample code (mostly in contacts index view) which refreshes the captcha image via jQuery.</p>

<h2>
<a name="authentication" class="anchor" href="#authentication"><span class="octicon octicon-link"></span></a>Authentication</h2>

<p>If you are using the authentication component, ensure that the captcha action (that generates the image) is granted access.</p>

<h2>
<a name="sample-code" class="anchor" href="#sample-code"><span class="octicon octicon-link"></span></a>Sample Code</h2>

<p>Model Contact.php</p>

<pre><code>&lt;?php
App::uses('AppModel', 'Model');
class Contact extends AppModel {
    public $actsAs = array(
        'Captcha' =&gt; array(
            'field' =&gt; array('captcha', 'captcha-2'),
            'error' =&gt; 'Captcha code entered invalid'
        )
    );
}
?&gt;
</code></pre>

<p>Controller ContactsController.php</p>

<pre><code>&lt;?php
App::uses('AppController', 'Controller');
class ContactsController extends AppController {
    public $captchas = array('captcha', 'captcha-2');

    public $components = array(
        'Captcha' =&gt; array(
            'rotate' =&gt; true
        ),
        'RequestHandler'
    );

    public function captcha()  {
        $this-&gt;autoRender = false;
        $captcha = basename($this-&gt;params['url']['url'], '.jpg');
        $this-&gt;Captcha-&gt;generate($captcha);
    }

    public function index() {
        if ($this-&gt;RequestHandler-&gt;isPost()) {
            foreach($this-&gt;captchas as $field) {
                $this-&gt;Contact-&gt;setCaptcha($field,
                    $this-&gt;Captcha-&gt;getCode($field));
            };
            $this-&gt;Contact-&gt;set($this-&gt;request-&gt;data);
            if ($this-&gt;Contact-&gt;validates()) {
                $this-&gt;Session-&gt;setFlash('Captcha codes validated successfully',
                    'flash_good');
            }
        }
        $this-&gt;set('captcha_fields', $this-&gt;captchas);
    }
}
?&gt;
</code></pre>

<p>Route Config/routes.php</p>

<pre><code>Router::connect('/img/captcha.jpg', array('controller' =&gt; 'contacts', 'action' =&gt; 'captcha'));
Router::connect('/img/captcha-2.jpg', array('controller' =&gt; 'contacts', 'action' =&gt; 'captcha'));
</code></pre>

<p>View Contacts/index.ctp</p>

<pre><code>&lt;?php
    echo $this-&gt;Form-&gt;create('Contact');
    foreach($captcha_fields as $index =&gt; $captcha) {
        echo $this-&gt;Html-&gt;image($captcha . '.jpg', array('id' =&gt; $captcha));
        echo $this-&gt;Html-&gt;link('reload image &amp;#x21bb;', '#', array('class' =&gt; 'reload', 'escape' =&gt; false));
        echo $this-&gt;Form-&gt;input($captcha, array('label' =&gt; 'Captcha', 'value' =&gt; '', 'tabindex' =&gt; $index + 1)); 
    }
    echo $this-&gt;Form-&gt;end('Submit');
?&gt;
</code></pre>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>Licensed under The MIT License<br>
Redistributions of files must retain the above copyright notice.</p>

<h2>
<a name="copyright" class="anchor" href="#copyright"><span class="octicon octicon-link"></span></a>Copyright</h2>

<p>Copyright (C) Donovan du Plessis, <a href="mailto:donovan@binarytrooper.com">donovan@binarytrooper.com</a></p>

<h2>
<a name="contributors" class="anchor" href="#contributors"><span class="octicon octicon-link"></span></a>Contributors</h2>

<p>Adriano Lu√≠s Rocha (ALR), <a href="https://github.com/adrianoluis">adrianlouis</a></p>

<h2>
<a name="changelog" class="anchor" href="#changelog"><span class="octicon octicon-link"></span></a>Changelog</h2>

<h5>
<a name="16-jun-04-2014" class="anchor" href="#16-jun-04-2014"><span class="octicon octicon-link"></span></a>1.6 [Jun 04, 2014]</h5>

<ul>
<li>Add support for multiple captchas per form (mubasshir request)</li>
</ul><h5>
<a name="15-aug-05-2013" class="anchor" href="#15-aug-05-2013"><span class="octicon octicon-link"></span></a>1.5 [Aug 05, 2013]</h5>

<ul>
<li>Add reload captcha image implementation to contacts sample code</li>
</ul><h5>
<a name="14-jun-19-2013" class="anchor" href="#14-jun-19-2013"><span class="octicon octicon-link"></span></a>1.4 [Jun 19, 2013]</h5>

<ul>
<li>Add initialize method to component to set correct image response type and body</li>
<li>Refactor readme document and script comments</li>
</ul><h5>
<a name="13-oct-25-2012" class="anchor" href="#13-oct-25-2012"><span class="octicon octicon-link"></span></a>1.3 [Oct 25, 2012]</h5>

<ul>
<li>Set font path to Lib/Fonts (ALR)</li>
<li>Access Model reference correctly in Behavior (ALR)</li>
</ul><h5>
<a name="12-oct-17-2012" class="anchor" href="#12-oct-17-2012"><span class="octicon octicon-link"></span></a>1.2 [Oct 17, 2012]</h5>

<ul>
<li>Set component and behavior to framework 2.0 compliant (ALR)</li>
</ul><h5>
<a name="11-apr-18-2012" class="anchor" href="#11-apr-18-2012"><span class="octicon octicon-link"></span></a>1.1 [Apr 18, 2012]</h5>

<ul>
<li>Add character limit configuration to component</li>
<li>Initial default configuration settings in Behavior</li>
<li>Refactor code and readme document</li>
</ul><h5>
<a name="10-mar-29-2012" class="anchor" href="#10-mar-29-2012"><span class="octicon octicon-link"></span></a>1.0 [Mar 29, 2012]</h5>

<ul>
<li>Initial Version</li>
</ul>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/donovan-duplessis/cakephp-captcha/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/donovan-duplessis/cakephp-captcha/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/donovan-duplessis/cakephp-captcha"></a> is maintained by <a href="https://github.com/donovan-duplessis">donovan-duplessis</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>